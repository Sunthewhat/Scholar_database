// @bun
var Le=Object.create;var{getPrototypeOf:Be,defineProperty:fe,getOwnPropertyNames:Fe}=Object;var _e=Object.prototype.hasOwnProperty;var Ve=(e,t,r)=>{r=e!=null?Le(Be(e)):{};let s=t||!e||!e.__esModule?fe(r,"default",{value:e,enumerable:!0}):r;for(let n of Fe(e))if(!_e.call(s,n))fe(s,n,{get:()=>e[n],enumerable:!0});return s};var ze=import.meta.require;var J=(e,t,r)=>{return(s,n)=>{let o=-1;return i(0);async function i(a){if(a<=o)throw new Error("next() called multiple times");o=a;let c,l=!1,f;if(e[a])f=e[a][0][0],s.req.routeIndex=a;else f=a===e.length&&n||void 0;if(f)try{c=await f(s,()=>i(a+1))}catch(u){if(u instanceof Error&&t)s.error=u,c=await t(u,s),l=!0;else throw u}else if(s.finalized===!1&&r)c=await r(s);if(c&&(s.finalized===!1||l))s.res=c;return s}}};var ue=Symbol();var he=async(e,t=Object.create(null))=>{let{all:r=!1,dot:s=!1}=t,o=(e instanceof q?e.raw.headers:e.headers).get("Content-Type");if(o?.startsWith("multipart/form-data")||o?.startsWith("application/x-www-form-urlencoded"))return Ke(e,{all:r,dot:s});return{}};async function Ke(e,t){let r=await e.formData();if(r)return Ue(r,t);return{}}function Ue(e,t){let r=Object.create(null);if(e.forEach((s,n)=>{if(!(t.all||n.endsWith("[]")))r[n]=s;else Ge(r,n,s)}),t.dot)Object.entries(r).forEach(([s,n])=>{if(s.includes("."))We(r,s,n),delete r[s]});return r}var Ge=(e,t,r)=>{if(e[t]!==void 0)if(Array.isArray(e[t]))e[t].push(r);else e[t]=[e[t],r];else if(!t.endsWith("[]"))e[t]=r;else e[t]=[r]},We=(e,t,r)=>{let s=e,n=t.split(".");n.forEach((o,i)=>{if(i===n.length-1)s[o]=r;else{if(!s[o]||typeof s[o]!=="object"||Array.isArray(s[o])||s[o]instanceof File)s[o]=Object.create(null);s=s[o]}})};var Y=(e)=>{let t=e.split("/");if(t[0]==="")t.shift();return t},de=(e)=>{let{groups:t,path:r}=Qe(e),s=Y(r);return ke(s,t)},Qe=(e)=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{let n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},ke=(e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},I={},ge=(e,t)=>{if(e==="*")return"*";let r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let s=`${e}#${t}`;if(!I[s])if(r[2])I[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)];else I[s]=[e,r[1],!0];return I[s]}return null},L=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,(r)=>{try{return t(r)}catch{return r}})}},Xe=(e)=>L(e,decodeURI),M=(e)=>{let t=e.url,r=t.indexOf("/",t.charCodeAt(9)===58?13:8),s=r;for(;s<t.length;s++){let n=t.charCodeAt(s);if(n===37){let o=t.indexOf("?",s),i=t.slice(r,o===-1?void 0:o);return Xe(i.includes("%25")?i.replace(/%25/g,"%2525"):i)}else if(n===63)break}return t.slice(r,s)};var pe=(e)=>{let t=M(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},b=(e,t,...r)=>{if(r.length)t=b(t,...r);return`${e?.[0]==="/"?"":"/"}${e}${t==="/"?"":`${e?.at(-1)==="/"?"":"/"}${t?.[0]==="/"?t.slice(1):t}`}`},B=(e)=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;let t=e.split("/"),r=[],s="";return t.forEach((n)=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){if(r.length===0&&s==="")r.push("/");else r.push(s);let o=n.replace("?","");s+="/"+o,r.push(s)}else s+="/"+n}),r.filter((n,o,i)=>i.indexOf(n)===o)},Z=(e)=>{if(!/[%+]/.test(e))return e;if(e.indexOf("+")!==-1)e=e.replace(/\+/g," ");return e.indexOf("%")!==-1?L(e,ee):e},ye=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let i=e.indexOf(`?${t}`,8);if(i===-1)i=e.indexOf(`&${t}`,8);while(i!==-1){let a=e.charCodeAt(i+t.length+1);if(a===61){let c=i+t.length+2,l=e.indexOf("&",c);return Z(e.slice(c,l===-1?void 0:l))}else if(a==38||isNaN(a))return"";i=e.indexOf(`&${t}`,i+1)}if(s=/[%+]/.test(e),!s)return}let n={};s??=/[%+]/.test(e);let o=e.indexOf("?",8);while(o!==-1){let i=e.indexOf("&",o+1),a=e.indexOf("=",o);if(a>i&&i!==-1)a=-1;let c=e.slice(o+1,a===-1?i===-1?void 0:i:a);if(s)c=Z(c);if(o=i,c==="")continue;let l;if(a===-1)l="";else if(l=e.slice(a+1,i===-1?void 0:i),s)l=Z(l);if(r){if(!(n[c]&&Array.isArray(n[c])))n[c]=[];n[c].push(l)}else n[c]??=l}return t?n[t]:n},xe=ye,ve=(e,t)=>{return ye(e,t,!0)},ee=decodeURIComponent;var we=(e)=>L(e,ee),q=class{raw;#t;#e;routeIndex=0;path;bodyCache={};constructor(e,t="/",r=[[]]){this.raw=e,this.path=t,this.#e=r,this.#t={}}param(e){return e?this.#r(e):this.#o()}#r(e){let t=this.#e[0][this.routeIndex][1][e],r=this.#n(t);return r?/\%/.test(r)?we(r):r:void 0}#o(){let e={},t=Object.keys(this.#e[0][this.routeIndex][1]);for(let r of t){let s=this.#n(this.#e[0][this.routeIndex][1][r]);if(s&&typeof s==="string")e[r]=/\%/.test(s)?we(s):s}return e}#n(e){return this.#e[1]?this.#e[1][e]:e}query(e){return xe(this.url,e)}queries(e){return ve(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;let t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){return this.bodyCache.parsedBody??=await he(this,e)}#s=(e)=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let n=Object.keys(t)[0];if(n)return t[n].then((o)=>{if(n==="json")o=JSON.stringify(o);return new Response(o)[e]()});return t[e]=r[e]()};json(){return this.#s("json")}text(){return this.#s("text")}arrayBuffer(){return this.#s("arrayBuffer")}blob(){return this.#s("blob")}formData(){return this.#s("formData")}addValidatedData(e,t){this.#t[e]=t}valid(e){return this.#t[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[ue](){return this.#e}get matchedRoutes(){return this.#e[0].map(([[,e]])=>e)}get routePath(){return this.#e[0].map(([[,e]])=>e)[this.routeIndex].path}};var Re={Stringify:1,BeforeStream:2,Stream:3},Je=(e,t)=>{let r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var te=async(e,t,r,s,n)=>{if(typeof e==="object"&&!(e instanceof String)){if(!(e instanceof Promise))e=e.toString();if(e instanceof Promise)e=await e}let o=e.callbacks;if(!o?.length)return Promise.resolve(e);if(n)n[0]+=e;else n=[e];let i=Promise.all(o.map((a)=>a({phase:t,buffer:n,context:s}))).then((a)=>Promise.all(a.filter(Boolean).map((c)=>te(c,t,!1,s,n))).then(()=>n[0]));if(r)return Je(await i,o);else return i};var Ze="text/plain; charset=UTF-8",re=(e,t)=>{return{"Content-Type":e,...t}},be=class{#t;#e;env={};#r;finalized=!1;error;#o;#n;#s;#f;#a;#l;#c;#u;#h;constructor(e,t){if(this.#t=e,t)this.#n=t.executionCtx,this.env=t.env,this.#l=t.notFoundHandler,this.#h=t.path,this.#u=t.matchResult}get req(){return this.#e??=new q(this.#t,this.#h,this.#u),this.#e}get event(){if(this.#n&&"respondWith"in this.#n)return this.#n;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#n)return this.#n;else throw Error("This context has no ExecutionContext")}get res(){return this.#s||=new Response(null,{headers:this.#c??=new Headers})}set res(e){if(this.#s&&e){e=new Response(e.body,e);for(let[t,r]of this.#s.headers.entries()){if(t==="content-type")continue;if(t==="set-cookie"){let s=this.#s.headers.getSetCookie();e.headers.delete("set-cookie");for(let n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}}this.#s=e,this.finalized=!0}render=(...e)=>{return this.#a??=(t)=>this.html(t),this.#a(...e)};setLayout=(e)=>this.#f=e;getLayout=()=>this.#f;setRenderer=(e)=>{this.#a=e};header=(e,t,r)=>{if(this.finalized)this.#s=new Response(this.#s.body,this.#s);let s=this.#s?this.#s.headers:this.#c??=new Headers;if(t===void 0)s.delete(e);else if(r?.append)s.append(e,t);else s.set(e,t)};status=(e)=>{this.#o=e};set=(e,t)=>{this.#r??=new Map,this.#r.set(e,t)};get=(e)=>{return this.#r?this.#r.get(e):void 0};get var(){if(!this.#r)return{};return Object.fromEntries(this.#r)}#i(e,t,r){let s=this.#s?new Headers(this.#s.headers):this.#c??new Headers;if(typeof t==="object"&&"headers"in t){let o=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(let[i,a]of o)if(i.toLowerCase()==="set-cookie")s.append(i,a);else s.set(i,a)}if(r)for(let[o,i]of Object.entries(r))if(typeof i==="string")s.set(o,i);else{s.delete(o);for(let a of i)s.append(o,a)}let n=typeof t==="number"?t:t?.status??this.#o;return new Response(e,{status:n,headers:s})}newResponse=(...e)=>this.#i(...e);body=(e,t,r)=>this.#i(e,t,r);text=(e,t,r)=>{return!this.#c&&!this.#o&&!t&&!r&&!this.finalized?new Response(e):this.#i(e,t,re(Ze,r))};json=(e,t,r)=>{return this.#i(JSON.stringify(e),t,re("application/json",r))};html=(e,t,r)=>{let s=(n)=>this.#i(n,t,re("text/html; charset=UTF-8",r));return typeof e==="object"?te(e,Re.Stringify,!1,{}).then(s):s(e)};redirect=(e,t)=>{return this.header("Location",String(e)),this.newResponse(null,t??302)};notFound=()=>{return this.#l??=()=>new Response,this.#l(this)}};var h="ALL",Pe="all",me=["get","post","put","delete","options","patch"],F="Can not add a route since the matcher is already built.",_=class extends Error{};var Ee="__COMPOSED_HANDLER";var Ye=(e)=>{return e.text("404 Not Found",404)},Oe=(e,t)=>{if("getResponse"in e){let r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},se=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#t="/";routes=[];constructor(e={}){[...me,Pe].forEach((n)=>{this[n]=(o,...i)=>{if(typeof o==="string")this.#t=o;else this.#o(n,this.#t,o);return i.forEach((a)=>{this.#o(n,this.#t,a)}),this}}),this.on=(n,o,...i)=>{for(let a of[o].flat()){this.#t=a;for(let c of[n].flat())i.map((l)=>{this.#o(c.toUpperCase(),this.#t,l)})}return this},this.use=(n,...o)=>{if(typeof n==="string")this.#t=n;else this.#t="*",o.unshift(n);return o.forEach((i)=>{this.#o(h,this.#t,i)}),this};let{strict:r,...s}=e;Object.assign(this,s),this.getPath=r??!0?e.getPath??M:pe}#e(){let e=new se({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,e.#r=this.#r,e.routes=this.routes,e}#r=Ye;errorHandler=Oe;route(e,t){let r=this.basePath(e);return t.routes.map((s)=>{let n;if(t.errorHandler===Oe)n=s.handler;else n=async(o,i)=>(await J([],t.errorHandler)(o,()=>s.handler(o,i))).res,n[Ee]=s.handler;r.#o(s.method,s.path,n)}),this}basePath(e){let t=this.#e();return t._basePath=b(this._basePath,e),t}onError=(e)=>{return this.errorHandler=e,this};notFound=(e)=>{return this.#r=e,this};mount(e,t,r){let s,n;if(r)if(typeof r==="function")n=r;else if(n=r.optionHandler,r.replaceRequest===!1)s=(a)=>a;else s=r.replaceRequest;let o=n?(a)=>{let c=n(a);return Array.isArray(c)?c:[c]}:(a)=>{let c=void 0;try{c=a.executionCtx}catch{}return[a.env,c]};s||=(()=>{let a=b(this._basePath,e),c=a==="/"?0:a.length;return(l)=>{let f=new URL(l.url);return f.pathname=f.pathname.slice(c)||"/",new Request(f,l)}})();let i=async(a,c)=>{let l=await t(s(a.req.raw),...o(a));if(l)return l;await c()};return this.#o(h,b(e,"*"),i),this}#o(e,t,r){e=e.toUpperCase(),t=b(this._basePath,t);let s={basePath:this._basePath,path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)}#n(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}#s(e,t,r,s){if(s==="HEAD")return(async()=>new Response(null,await this.#s(e,t,r,"GET")))();let n=this.getPath(e,{env:r}),o=this.router.match(s,n),i=new be(e,{path:n,matchResult:o,env:r,executionCtx:t,notFoundHandler:this.#r});if(o[0].length===1){let c;try{c=o[0][0][0][0](i,async()=>{i.res=await this.#r(i)})}catch(l){return this.#n(l,i)}return c instanceof Promise?c.then((l)=>l||(i.finalized?i.res:this.#r(i))).catch((l)=>this.#n(l,i)):c??this.#r(i)}let a=J(o[0],this.errorHandler,this.#r);return(async()=>{try{let c=await a(i);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return this.#n(c,i)}})()}fetch=(e,...t)=>{return this.#s(e,t[1],t[0],e.method)};request=(e,t,r,s)=>{if(e instanceof Request)return this.fetch(t?new Request(e,t):e,r,s);return e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${b("/",e)}`,t),r,s)};fire=()=>{addEventListener("fetch",(e)=>{e.respondWith(this.#s(e.request,e,void 0,e.request.method))})}};var V="[^/]+",$=".*",N="(?:|/.*)",E=Symbol(),Me=new Set(".\\+*[^]$()");function et(e,t){if(e.length===1)return t.length===1?e<t?-1:1:-1;if(t.length===1)return 1;if(e===$||e===N)return 1;else if(t===$||t===N)return-1;if(e===V)return 1;else if(t===V)return-1;return e.length===t.length?e<t?-1:1:t.length-e.length}var z=class{#t;#e;#r=Object.create(null);insert(e,t,r,s,n){if(e.length===0){if(this.#t!==void 0)throw E;if(n)return;this.#t=t;return}let[o,...i]=e,a=o==="*"?i.length===0?["","",$]:["","",V]:o==="/*"?["","",N]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(a){let l=a[1],f=a[2]||V;if(l&&a[2]){if(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f))throw E}if(c=this.#r[f],!c){if(Object.keys(this.#r).some((u)=>u!==$&&u!==N))throw E;if(n)return;if(c=this.#r[f]=new z,l!=="")c.#e=s.varIndex++}if(!n&&l!=="")r.push([l,c.#e])}else if(c=this.#r[o],!c){if(Object.keys(this.#r).some((l)=>l.length>1&&l!==$&&l!==N))throw E;if(n)return;c=this.#r[o]=new z}c.insert(i,t,r,s,n)}buildRegExpStr(){let t=Object.keys(this.#r).sort(et).map((r)=>{let s=this.#r[r];return(typeof s.#e==="number"?`(${r})@${s.#e}`:Me.has(r)?`\\${r}`:r)+s.buildRegExpStr()});if(typeof this.#t==="number")t.unshift(`#${this.#t}`);if(t.length===0)return"";if(t.length===1)return t[0];return"(?:"+t.join("|")+")"}};var He=class{#t={varIndex:0};#e=new z;insert(e,t,r){let s=[],n=[];for(let i=0;;){let a=!1;if(e=e.replace(/\{[^}]+\}/g,(c)=>{let l=`@\\${i}`;return n[i]=[l,c],i++,a=!0,l}),!a)break}let o=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let i=n.length-1;i>=0;i--){let[a]=n[i];for(let c=o.length-1;c>=0;c--)if(o[c].indexOf(a)!==-1){o[c]=o[c].replace(a,n[i][1]);break}}return this.#e.insert(o,t,s,this.#t,r),s}buildRegExp(){let e=this.#e.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,o,i)=>{if(o!==void 0)return r[++t]=Number(o),"$()";if(i!==void 0)return s[Number(i)]=++t,"";return""}),[new RegExp(`^${e}`),r,s]}};var Ce=[],tt=[/^$/,[],Object.create(null)],$e=Object.create(null);function Ne(e){return $e[e]??=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`)}function rt(){$e=Object.create(null)}function st(e){let t=new He,r=[];if(e.length===0)return tt;let s=e.map((l)=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,f],[u,g])=>l?1:u?-1:f.length-g.length),n=Object.create(null);for(let l=0,f=-1,u=s.length;l<u;l++){let[g,y,d]=s[l];if(g)n[y]=[d.map(([x])=>[x,Object.create(null)]),Ce];else f++;let p;try{p=t.insert(y,f,g)}catch(x){throw x===E?new _(y):x}if(g)continue;r[f]=d.map(([x,m])=>{let C=Object.create(null);m-=1;for(;m>=0;m--){let[v,X]=p[m];C[v]=X}return[x,C]})}let[o,i,a]=t.buildRegExp();for(let l=0,f=r.length;l<f;l++)for(let u=0,g=r[l].length;u<g;u++){let y=r[l][u]?.[1];if(!y)continue;let d=Object.keys(y);for(let p=0,x=d.length;p<x;p++)y[d[p]]=a[y[d[p]]]}let c=[];for(let l in i)c[l]=r[i[l]];return[o,c,n]}function O(e,t){if(!e)return;for(let r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Ne(r).test(t))return[...e[r]];return}var ne=class{name="RegExpRouter";#t;#e;constructor(){this.#t={[h]:Object.create(null)},this.#e={[h]:Object.create(null)}}add(e,t,r){let s=this.#t,n=this.#e;if(!s||!n)throw new Error(F);if(!s[e])[s,n].forEach((a)=>{a[e]=Object.create(null),Object.keys(a[h]).forEach((c)=>{a[e][c]=[...a[h][c]]})});if(t==="/*")t="*";let o=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let a=Ne(t);if(e===h)Object.keys(s).forEach((c)=>{s[c][t]||=O(s[c],t)||O(s[h],t)||[]});else s[e][t]||=O(s[e],t)||O(s[h],t)||[];Object.keys(s).forEach((c)=>{if(e===h||e===c)Object.keys(s[c]).forEach((l)=>{a.test(l)&&s[c][l].push([r,o])})}),Object.keys(n).forEach((c)=>{if(e===h||e===c)Object.keys(n[c]).forEach((l)=>a.test(l)&&n[c][l].push([r,o]))});return}let i=B(t)||[t];for(let a=0,c=i.length;a<c;a++){let l=i[a];Object.keys(n).forEach((f)=>{if(e===h||e===f)n[f][l]||=[...O(s[f],l)||O(s[h],l)||[]],n[f][l].push([r,o-c+a+1])})}}match(e,t){rt();let r=this.#r();return this.match=(s,n)=>{let o=r[s]||r[h],i=o[2][n];if(i)return i;let a=n.match(o[0]);if(!a)return[[],Ce];let c=a.indexOf("",1);return[o[1][c],a]},this.match(e,t)}#r(){let e=Object.create(null);return Object.keys(this.#e).concat(Object.keys(this.#t)).forEach((t)=>{e[t]||=this.#o(t)}),this.#t=this.#e=void 0,e}#o(e){let t=[],r=e===h;if([this.#t,this.#e].forEach((s)=>{let n=s[e]?Object.keys(s[e]).map((o)=>[o,s[e][o]]):[];if(n.length!==0)r||=!0,t.push(...n);else if(e!==h)t.push(...Object.keys(s[h]).map((o)=>[o,s[h][o]]))}),!r)return null;else return st(t)}};var oe=class{name="SmartRouter";#t=[];#e=[];constructor(e){this.#t=e.routers}add(e,t,r){if(!this.#e)throw new Error(F);this.#e.push([e,t,r])}match(e,t){if(!this.#e)throw new Error("Fatal error");let r=this.#t,s=this.#e,n=r.length,o=0,i;for(;o<n;o++){let a=r[o];try{for(let c=0,l=s.length;c<l;c++)a.add(...s[c]);i=a.match(e,t)}catch(c){if(c instanceof _)continue;throw c}this.match=a.match.bind(a),this.#t=[a],this.#e=void 0;break}if(o===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,i}get activeRouter(){if(this.#e||this.#t.length!==1)throw new Error("No active router has been determined yet.");return this.#t[0]}};var j=Object.create(null),ie=class{#t;#e;#r;#o=0;#n=j;constructor(e,t,r){if(this.#e=r||Object.create(null),this.#t=[],e&&t){let s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},this.#t=[s]}this.#r=[]}insert(e,t,r){this.#o=++this.#o;let s=this,n=de(t),o=[];for(let i=0,a=n.length;i<a;i++){let c=n[i],l=n[i+1],f=ge(c,l),u=Array.isArray(f)?f[0]:c;if(u in s.#e){if(s=s.#e[u],f)o.push(f[1]);continue}if(s.#e[u]=new ie,f)s.#r.push(f),o.push(f[1]);s=s.#e[u]}return s.#t.push({[e]:{handler:r,possibleKeys:o.filter((i,a,c)=>c.indexOf(i)===a),score:this.#o}}),s}#s(e,t,r,s){let n=[];for(let o=0,i=e.#t.length;o<i;o++){let a=e.#t[o],c=a[t]||a[h],l={};if(c!==void 0){if(c.params=Object.create(null),n.push(c),r!==j||s&&s!==j)for(let f=0,u=c.possibleKeys.length;f<u;f++){let g=c.possibleKeys[f],y=l[c.score];c.params[g]=s?.[g]&&!y?s[g]:r[g]??s?.[g],l[c.score]=!0}}}return n}search(e,t){let r=[];this.#n=j;let n=[this],o=Y(t),i=[];for(let a=0,c=o.length;a<c;a++){let l=o[a],f=a===c-1,u=[];for(let g=0,y=n.length;g<y;g++){let d=n[g],p=d.#e[l];if(p)if(p.#n=d.#n,f){if(p.#e["*"])r.push(...this.#s(p.#e["*"],e,d.#n));r.push(...this.#s(p,e,d.#n))}else u.push(p);for(let x=0,m=d.#r.length;x<m;x++){let C=d.#r[x],v=d.#n===j?{}:{...d.#n};if(C==="*"){let R=d.#e["*"];if(R)r.push(...this.#s(R,e,d.#n)),R.#n=v,u.push(R);continue}if(!l)continue;let[X,le,T]=C,w=d.#e[X],qe=o.slice(a).join("/");if(T instanceof RegExp){let R=T.exec(qe);if(R){if(v[le]=R[0],r.push(...this.#s(w,e,d.#n,v)),Object.keys(w.#e).length){w.#n=v;let Ie=R[0].match(/\//)?.length??0;(i[Ie]||=[]).push(w)}continue}}if(T===!0||T.test(l))if(v[le]=l,f){if(r.push(...this.#s(w,e,v,d.#n)),w.#e["*"])r.push(...this.#s(w.#e["*"],e,v,d.#n))}else w.#n=v,u.push(w)}}n=u.concat(i.shift()??[])}if(r.length>1)r.sort((a,c)=>{return a.score-c.score});return[r.map(({handler:a,params:c})=>[a,c])]}};var ce=class{name="TrieRouter";#t;constructor(){this.#t=new ie}add(e,t,r){let s=B(t);if(s){for(let n=0,o=s.length;n<o;n++)this.#t.insert(e,s[n],r);return}this.#t.insert(e,t,r)}match(e,t){return this.#t.search(e,t)}};var P=class extends se{constructor(e={}){super(e);this.router=e.router??new oe({routers:[new ne,new ce]})}};function nt(){let{process:e,Deno:t}=globalThis;return!(typeof t?.noColor==="boolean"?t.noColor:e!==void 0?"NO_COLOR"in e?.env:!1)}async function je(){let{navigator:e}=globalThis,t="cloudflare:workers";return!(e!==void 0&&e.userAgent==="Cloudflare-Workers"?await(async()=>{try{return"NO_COLOR"in((await import("cloudflare:workers")).env??{})}catch{return!1}})():!nt())}var ot=(e)=>{let[t,r]=[",","."];return e.map((n)=>n.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+t)).join(r)},it=(e)=>{let t=Date.now()-e;return ot([t<1000?t+"ms":Math.round(t/1000)+"s"])},ct=async(e)=>{if(await je())switch(e/100|0){case 5:return`\x1B[31m${e}\x1B[0m`;case 4:return`\x1B[33m${e}\x1B[0m`;case 3:return`\x1B[36m${e}\x1B[0m`;case 2:return`\x1B[32m${e}\x1B[0m`}return`${e}`};async function Se(e,t,r,s,n=0,o){let i=t==="<--"?`${t} ${r} ${s}`:`${t} ${r} ${s} ${await ct(n)} ${o}`;e(i)}var Ae=(e=console.log)=>{return async function t(r,s){let{method:n,url:o}=r.req,i=o.slice(o.indexOf("/",8));await Se(e,"<--",n,i);let a=Date.now();await s(),await Se(e,"-->",n,i,r.res.status,it(a))}};var De=(e)=>{let r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=((o)=>{if(typeof o==="string")if(o==="*")return()=>o;else return(i)=>o===i?i:null;else if(typeof o==="function")return o;else return(i)=>o.includes(i)?i:null})(r.origin),n=((o)=>{if(typeof o==="function")return o;else if(Array.isArray(o))return()=>o;else return()=>[]})(r.allowMethods);return async function o(i,a){function c(f,u){i.res.headers.set(f,u)}let l=s(i.req.header("origin")||"",i);if(l)c("Access-Control-Allow-Origin",l);if(r.origin!=="*"){let f=i.req.header("Vary");if(f)c("Vary",f);else c("Vary","Origin")}if(r.credentials)c("Access-Control-Allow-Credentials","true");if(r.exposeHeaders?.length)c("Access-Control-Expose-Headers",r.exposeHeaders.join(","));if(i.req.method==="OPTIONS"){if(r.maxAge!=null)c("Access-Control-Max-Age",r.maxAge.toString());let f=n(i.req.header("origin")||"",i);if(f.length)c("Access-Control-Allow-Methods",f.join(","));let u=r.allowHeaders;if(!u?.length){let g=i.req.header("Access-Control-Request-Headers");if(g)u=g.split(/\s*,\s*/)}if(u?.length)c("Access-Control-Allow-Headers",u.join(",")),i.res.headers.append("Vary","Access-Control-Request-Headers");return i.res.headers.delete("Content-Length"),i.res.headers.delete("Content-Type"),new Response(null,{headers:i.res.headers,status:204,statusText:"No Content"})}await a()}};import{promises as A}from"fs";import{join as ae}from"path";var K=(e,t,r)=>{return{success:e,msg:t,data:r||typeof r==="boolean"?r:null}},S=(e,t)=>[K(!0,e,t),200],H=(e,t)=>{if(t)return[K(!1,e),t];return[K(!1,e),400]},U=(e)=>[K(!1,`${e}`),500];var G="/app/uploads",W={upload:async(e)=>{try{let r=(await e.req.formData()).get("file");if(!r)return e.json(...H("\u0E44\u0E21\u0E48\u0E1E\u0E1A\u0E44\u0E1F\u0E25\u0E4C"));await A.mkdir(G,{recursive:!0});let s=`${Date.now()}-${r.name}`,n=ae(G,s),o=await r.arrayBuffer();await A.writeFile(n,new Uint8Array(o));let i=`/api/v1/storage/file/${s}`;return e.json(...S("\u0E2D\u0E31\u0E1B\u0E42\u0E2B\u0E25\u0E14\u0E44\u0E1F\u0E25\u0E4C\u0E2A\u0E33\u0E40\u0E23\u0E47\u0E08!",{url:i,filename:s,originalName:r.name,size:r.size,type:r.type}))}catch(t){return e.json(...U(t))}},getFile:async(e)=>{try{let t=e.req.param("filename");if(!t)return e.json(...H("\u0E44\u0E21\u0E48\u0E1E\u0E1A\u0E0A\u0E37\u0E48\u0E2D\u0E44\u0E1F\u0E25\u0E4C"));let r=ae(G,t);try{await A.access(r)}catch{return e.json(...H("\u0E44\u0E21\u0E48\u0E1E\u0E1A\u0E44\u0E1F\u0E25\u0E4C",404))}let s=Bun.file(r);return new Response(s)}catch(t){return e.json(...U(t))}},deleteFile:async(e)=>{try{let t=e.req.param("filename");if(!t)return e.json(...H("\u0E44\u0E21\u0E48\u0E1E\u0E1A\u0E0A\u0E37\u0E48\u0E2D\u0E44\u0E1F\u0E25\u0E4C"));let r=ae(G,t);try{await A.access(r),await A.unlink(r)}catch{return e.json(...H("\u0E44\u0E21\u0E48\u0E1E\u0E1A\u0E44\u0E1F\u0E25\u0E4C",404))}return e.json(...S("\u0E25\u0E1A\u0E44\u0E1F\u0E25\u0E4C\u0E2A\u0E33\u0E40\u0E23\u0E47\u0E08!"))}catch(t){return e.json(...U(t))}}};var D=new P;D.post("/upload",W.upload);D.get("/file/:filename",W.getFile);D.delete("/file/:filename",W.deleteFile);var Q=new P;Q.get("/",(e)=>e.json(...S("HELLO")));Q.route("/storage",D);var Te=Bun.env.ORIGIN||"";if(!Te)console.error("No Environment Origin found");var k=new P().basePath("api"),at=Bun.env.DEVELOPMENT;if(at!=="PROD")k.use(Ae());k.use(De({origin:[Te]}));k.route("v1",Q);var Br={fetch:k.fetch,port:9000};export{Br as default};
